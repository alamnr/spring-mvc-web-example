<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-5.4.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

		
		<bean id ="passwordEncoder" class = "org.springframework.security.crypto.password.NoOpPasswordEncoder" factory-method = "getInstance" />
		
		<!-- <bean id ="passwordEncoder" class = "org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" /> -->
		

		
    		<security:http auto-config="false" use-expressions="true">
    		
    		<security:intercept-url pattern="/secure" access="hasRole('ADMIN')"/>
			<security:intercept-url pattern="/add"  access="hasRole('ADMIN')"/>
			<security:intercept-url pattern="/ghap"  access="hasRole('USER')"/>
			
			
			<security:intercept-url pattern="/static/**" access="permitAll"/> 		
    		<security:intercept-url pattern="/about" access="permitAll"/>
    		<security:intercept-url pattern="/login" access="permitAll"/>
    		<security:intercept-url pattern="/register" access="permitAll"/>
    		<security:intercept-url pattern="/" access="permitAll"/>
    		
			
			<security:access-denied-handler error-page="/WEB-INF/jsp/accessDenied.jsp"/>		
			 
			 <!-- default login -->
			<!-- <security:form-login/>  -->
			 <!--Custom login  -->
			<security:form-login login-page="/login" login-processing-url="/login" username-parameter="custom_username" 
						password-parameter="custom_password" default-target-url="/" always-use-default-target="true"
						authentication-failure-url="/login?error=true"/>  
									
			<security:logout delete-cookies="JSESSIONID"  invalidate-session="true" logout-url="/logout" 
								logout-success-url="/login?logout=true"/>
			
			<!-- <security:http-basic/> -->
			
			<!-- <security:csrf disabled="true"/>  -->
		</security:http>
		
		
		
		<security:authentication-manager>
			<security:authentication-provider>
			<!-- <security:jdbc-user-service data-source-ref="dataSource" /> -->
				<security:jdbc-user-service data-source-ref="dataSource" 
					group-authorities-by-username-query="select g.id, g.group_name, ga.authority
					from groups g, group_members gm, group_authorities ga where gm.username = ? and 
					g.id = ga.group_id and g.id = gm.group_id"
				/> 
				<security:password-encoder ref="passwordEncoder"/>
			</security:authentication-provider>		
		</security:authentication-manager>
</beans>
